<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cirurgic3D - Detalhes do Caso</title>
    <link rel="stylesheet" href="../assets/css/global.css">
    <style>
        /* Estrutura de Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        /* Visualizador 3D */
        .viewer-3d {
            background: #0a0a23;
            border-radius: 12px;
            height: 350px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .viewer-3d img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: center;
            background: #000;
            cursor: pointer;
            filter: drop-shadow(0 0 20px rgba(0, 0, 0, 0.5));
        }

        /* Componentes de Informa√ß√£o */
        .badge-id-large {
            background: #e0f2f1;
            color: #00897b;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            margin: 20px 0;
            font-size: 1.1rem;
            border: 1px solid #b2dfdb;
        }

        .info-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        /* Grid de Exames */
        .exam-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .exam-card {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px;
            background: #f8fafc;
        }

        .exam-card img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 4px;
            background: #000;
        }

        /* Timeline e A√ß√µes */
        .timeline {
            border-left: 2px solid #3b82f6;
            margin-left: 10px;
            padding-left: 20px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .action-bar {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .search-container {
            flex: 1;
        }

        /* Imagens do Caso */
        .case-img {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .case-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>

<body>
    <nav class="navbar">
        <div class="navbar-left">
            <a href="../Home/index.html" class="navbar-logo">
                <img src="../assets/img/logo.svg" alt="Cirurgic3D" />
            </a>
        </div>
        <ul class="navbar-menu">
            <li><a href="../Home/index.html" class="nav-link active">Casos Cl√≠nicos</a></li>
            <li><a href="../Escores/index.html" class="nav-link">Escores Cl√≠nicos</a></li>
        </ul>

        <div class="user-menu-container" style="position: relative;">
            <img src="../assets/img/perfil.jpg" id="avatar-toggle" alt="Perfil"
                style="width: 35px; height: 35px; border-radius: 50%; cursor: pointer; border: 2px solid #e2e8f0;">

            <div id="user-dropdown" class="dropdown-menu">
                <a href="../Perfil/index.html" class="dropdown-item">Meu Perfil</a>
                <a href="../Perfil/ajuda.html" class="dropdown-item">Ajuda</a>
                <a href="../Perfil/sobre.html" class="dropdown-item">Sobre</a>
                <hr style="border: 0; border-top: 1px solid #f1f5f9; margin: 5px 0;">
                <a href="../auth/login.html" class="dropdown-item" style="color: #ef4444;">Sair</a>
            </div>
        </div>
    </nav>

    <main class="container">
        <nav class="breadcrumb">
            <a href="../Home/index.html" id="breadcrumb-link">Home</a>
            <span>&gt;</span>
            <strong id="breadcrumb-id">Carregando...</strong>
        </nav>

        <div class="viewer-3d"
            style="position: relative; display: flex; justify-content: center; align-items: center; background: #000; border-radius: 12px; height: 400px; overflow: hidden;">
           <a id="link3d-btn" href="#" style="text-decoration: none;">
                <button
                    style="position: absolute; top: 15px; left: 15px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 5px 12px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; gap: 5px; z-index: 10; transition: background 0.3s;">
                    Vista 3D
                </button>
            </a>
             <img id="main-3d-image" alt="3D Model">
        </div>

        <div
            style="background: #e9f7f2; color: #10b981; padding: 12px; border-radius: 8px; text-align: center; font-weight: 600; margin-bottom: 25px; border: 1px solid #d1f2e8;">
            Caso #<span id="display-id">---</span>
        </div>

        <section class="info-section" style="margin-bottom: 25px;">
            <h2 style="font-size: 1.1rem; margin-bottom: 25px; color: #1e293b;">Informa√ß√µes do Caso</h2>

            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px;">
                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div>
                        <label style="color: #64748b; font-size: 0.85rem; display: block; margin-bottom: 4px;">Refer√™ncia
                            do caso</label>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span id="info-ref" style="font-weight: 600; color: #1e293b;">---</span>
                            <span style="cursor: pointer; font-size: 0.8rem;">‚úèÔ∏è</span>
                        </div>
                    </div>
                    <div>
                        <label style="color: #64748b; font-size: 0.85rem; display: block; margin-bottom: 4px;">Tipo de
                            modelo</label>
                        <span id="info-model" style="font-weight: 600; color: #1e293b;">---</span>
                    </div>
                    <div>
                        <label style="color: #64748b; font-size: 0.85rem; display: block; margin-bottom: 4px;">Estado do
                            modelo</label>
                        <div style="display: flex; align-items: center; gap: 6px;">
                            <span style="width: 8px; height: 8px; background: #10b981; border-radius: 50%;"></span>
                            <span style="font-weight: 600; color: #1e293b;">Ativo</span>
                        </div>
                    </div>
                </div>

                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div>
                        <label style="color: #64748b; font-size: 0.85rem; display: block; margin-bottom: 4px;">Criado
                            por</label>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <img src="../assets/img/drcarlos.jpg"
                                style="width: 24px; height: 24px; border-radius: 50%; background: #eee;" alt="Avatar">
                            <span style="font-weight: 600; color: #1e293b;">Dr. Carlos Silva</span>
                        </div>
                    </div>
                    <div>
                        <label style="color: #64748b; font-size: 0.85rem; display: block; margin-bottom: 4px;">Data de
                            cria√ß√£o</label>
                        <span id="info-date" style="font-weight: 600; color: #1e293b;">---</span>
                    </div>
                    <div>
                        <label style="color: #64748b; font-size: 0.85rem; display: block; margin-bottom: 4px;">Laudo</label>
                        <p style="font-size: 0.85rem; color: #475569; line-height: 1.4;">Paciente com fratura complexa
                            em regi√£o mandibular, demandando abordagem cir√∫rgica especializada...</p>
                    </div>
                </div>

                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div>
                        <label style="color: #64748b; font-size: 0.85rem; display: block; margin-bottom: 4px;">Equipe</label>
                        <span style="font-weight: 600; color: #1e293b;">Cirurgia Maxilofacial</span>
                    </div>
                    <div>
                        <label style="color: #64748b; font-size: 0.85rem; display: block; margin-bottom: 4px;">Data do
                            procedimento</label>
                        <span style="font-weight: 600; color: #1e293b;">15 Fev 2024</span>
                    </div>
                    <div>
                        <label style="color: #64748b; font-size: 0.85rem; display: block; margin-bottom: 4px;">Notas do
                            caso</label>
                        <p style="font-size: 0.85rem; color: #475569; line-height: 1.4;">Paciente apresenta fratura
                            complexa na regi√£o mandibular. Planejamento cir√∫rgico requer modelo 3D.</p>
                    </div>
                </div>
            </div>

            <div
                style="margin-top: 30px; background: #f8fafc; padding: 12px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center;">
                <span style="font-family: monospace; font-size: 0.8rem; color: #64748b;">
                    Identificador √∫nico do dispositivo: <strong
                        id="unique-id">C3D-2024-0847-MDL-3D-SKULL-001</strong>
                </span>
                <span style="cursor: pointer; color: #64748b;">üìã</span>
            </div>
        </section>

        <section class="info-section">
            <h2>Escores Aplicados</h2>
            <div id="scoresContainer"></div>
        </section>

        <section class="info-section" style="margin-top: 25px;">
            <h2 style="font-size: 1.1rem; margin-bottom: 20px; color: #1e293b;">Mensagens</h2>

            <div id="chat-history" style="display: flex; flex-direction: column; gap: 20px; margin-bottom: 25px;">
                <div style="display: flex; gap: 12px;">
                    <img src="../assets/img/DraAnaCosta.jpg"
                        style="width: 32px; height: 32px; border-radius: 50%; background: #e2e8f0;" alt="Dra. Ana">
                    <div>
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                            <span style="font-weight: 600; font-size: 0.9rem; color: #1e293b;">Dra. Ana Costa</span>
                            <span style="color: #64748b; font-size: 0.75rem;">12 Jan 2024 √†s 14:30</span>
                        </div>
                        <p
                            style="font-size: 0.9rem; color: #475569; line-height: 1.5; background: #f8fafc; padding: 12px; border-radius: 0 12px 12px 12px; border: 1px solid #f1f5f9;">
                            O modelo 3D est√° perfeito para a visualiza√ß√£o da fratura. Poderiam apenas confirmar a escala
                            milim√©trica para a impress√£o da guia?
                        </p>
                    </div>
                </div>

                <div style="display: flex; gap: 12px;">
                    <div
                        style="width: 32px; height: 32px; border-radius: 50%; background: #0d9488; color: white; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold;">
                        C3D</div>
                    <div>
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                            <span style="font-weight: 600; font-size: 0.9rem; color: #1e293b;">Suporte T√©cnico
                                Cirurgic3D</span>
                            <span style="color: #64748b; font-size: 0.75rem;">12 Jan 2024 √†s 15:10</span>
                        </div>
                        <p
                            style="font-size: 0.9rem; color: #475569; line-height: 1.5; background: #f0fdfa; padding: 12px; border-radius: 0 12px 12px 12px; border: 1px solid #ccfbf1;">
                            Confirmado, Dra. Ana. A escala est√° em 1:1 com precis√£o de 0.02mm. O arquivo final j√° est√°
                            dispon√≠vel para download no dataset.
                        </p>
                    </div>
                </div>
            </div>

            <div style="border-top: 1px solid #f1f5f9; padding-top: 20px;">
                <label style="color: #64748b; font-size: 0.85rem; display: block; margin-bottom: 10px;">Adicionar novo
                    coment√°rio</label>
                <div style="position: relative;">
                    <textarea placeholder="Escreva sua mensagem aqui..."
                        style="width: 100%; height: 100px; padding: 12px; border-radius: 8px; border: 1px solid #cbd5e1; resize: none; font-family: inherit; font-size: 0.9rem;"></textarea>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                        <span style="font-size: 0.75rem; color: #94a3b8;">Sua mensagem ser√° vis√≠vel para toda a equipe
                            m√©dica e t√©cnica.</span>
                        <button class="btn-solid" style="padding: 8px 20px; font-size: 0.85rem;">Enviar Mensagem</button>
                    </div>
                </div>
            </div>
        </section>

        <section class="info-section" style="margin-top: 25px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="font-size: 1.1rem; color: #1e293b; margin: 0;">Pagamento</h2>
                <a href="#" style="font-size: 0.85rem; color: #3b82f6; text-decoration: none; display: flex; align-items: center; gap: 5px;">
                    Ver link de pagamento üìã
                </a>
            </div>

            <div class="payment-timeline">
                <div class="timeline-item active">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <div>
                            <h4 style="margin: 0; font-size: 0.95rem; color: #1e293b;">Pagamento Iniciado</h4>
                            <p style="margin: 4px 0 0; font-size: 0.85rem; color: #64748b;">Link de pagamento enviado ao
                                respons√°vel.</p>
                        </div>
                        <span style="font-size: 0.8rem; color: #94a3b8;">H√° 2 horas</span>
                    </div>
                </div>

                <div class="timeline-item active">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <div>
                            <h4 style="margin: 0; font-size: 0.95rem; color: #1e293b;">Aguardando Pagamento</h4>
                            <p style="margin: 4px 0 0; font-size: 0.85rem; color: #64748b;">Confirma√ß√£o de pagamento em
                                andamento.</p>
                        </div>
                        <span style="font-size: 0.8rem; color: #94a3b8;">H√° 5 horas</span>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <div>
                            <h4 style="margin: 0; font-size: 0.95rem; color: #94a3b8;">Pagamento Conclu√≠do</h4>
                            <p style="margin: 4px 0 0; font-size: 0.85rem; color: #94a3b8;">Pagamento confirmado com
                                sucesso.</p>
                        </div>
                        <span style="font-size: 0.8rem; color: #94a3b8;">---</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="info-section" style="margin-top: 25px; margin-bottom: 40px;">
            <h2 style="font-size: 1.1rem; color: #1e293b; margin-bottom: 25px;">Exames</h2>

            <div class="exams-container">
                <div class="exam-card-detailed">
                    <div class="exam-image-wrapper">
                        <span class="badge-published">Publicado</span>
                        <img src="../assets/img/casos/colon01.jpg" alt="CT Scan">
                    </div>
                    <div class="exam-details">
                        <div class="detail-row"><span class="detail-label">Data de aquisi√ß√£o</span><span class="detail-value">10 Jan 2024</span></div>
                        <div class="detail-row"><span class="detail-label">Modalidade</span><span class="detail-value">CT Scan</span></div>
                        <div class="detail-row"><span class="detail-label">Formato</span><span class="detail-value">DICOM</span></div>
                        <div class="detail-row"><span class="detail-label">Primeiro carregamento</span><span class="detail-value">15 Jan 2024</span></div>
                        <div class="detail-row"><span class="detail-label">ID</span><span class="detail-value">EX-001</span></div>
                        <button class="btn-validate">Validar</button>
                    </div>
                </div>

                <div class="exam-card-detailed">
                    <div class="exam-image-wrapper">
                        <span class="badge-published">Publicado</span>
                        <img src="../assets/img/casos/colon02.jpg" alt="CT Scan">
                    </div>
                    <div class="exam-details">
                        <div class="detail-row"><span class="detail-label">Data de aquisi√ß√£o</span><span class="detail-value">10 Jan 2024</span></div>
                        <div class="detail-row"><span class="detail-label">Modalidade</span><span class="detail-value">CT Scan</span></div>
                        <div class="detail-row"><span class="detail-label">Formato</span><span class="detail-value">DICOM</span></div>
                        <div class="detail-row"><span class="detail-label">Primeiro carregamento</span><span class="detail-value">15 Jan 2024</span></div>
                        <div class="detail-row"><span class="detail-label">ID</span><span class="detail-value">EX-002</span></div>
                        <button class="btn-validate">Validar</button>
                    </div>
                </div>
            </div>
        </section>

        <div style="display: flex; justify-content: center; gap: 15px; margin: 40px 0; flex-wrap: wrap;">
            <button
                style="display: flex; align-items: center; gap: 8px; background: #f0f9ff; color: #007bff; border: 1px solid #007bff; padding: 10px 24px; border-radius: 8px; font-weight: 500; cursor: pointer;">
                <span style="font-size: 1.1rem;">üîó</span> Link p√∫blico 3D
            </button>

            <button
                style="display: flex; align-items: center; gap: 8px; background: #f8fafc; color: #64748b; border: 1px solid #cbd5e1; padding: 10px 24px; border-radius: 8px; font-weight: 500; cursor: pointer;">
                <span style="font-size: 1.1rem;">üóëÔ∏è</span> Arquivar caso
            </button>

            <button
                style="display: flex; align-items: center; gap: 8px; background: #3b82f6; color: white; border: none; padding: 10px 24px; border-radius: 8px; font-weight: 500; cursor: pointer;">
                <span style="font-size: 1.1rem;">üì•</span> Download dataset
            </button>

            <button
                style="display: flex; align-items: center; gap: 8px; background: #3b82f6; color: white; border: none; padding: 10px 24px; border-radius: 8px; font-weight: 500; cursor: pointer;">
                <span style="font-size: 1.1rem;">üñ®Ô∏è</span> Imprimir Nota Fiscal
            </button>
        </div>
    </main>

    <script>
        // Dados dos casos
        const casesData = [
            { id: 'CASO-2024-003', date: '2024-01-13', desc: 'Tumor Renal (RENAL Score 7x) - Rim esquerdo', statusText: 'Aguardando pagamento', link3d: 'https://cirurgic3d.com.br/renal3dmodels/gbs/', thumb: '../assets/img/casos/Rim-esquerdo.jpg' },
            { id: 'CASO-2024-004', date: '2024-01-12', desc: 'Met√°stase hep√°tica - Segmento VII', statusText: 'Publicado', link3d: 'https://cirurgic3d.com.br/liver/cls/', thumb: '../assets/img/casos/Metastase-hep√°tica.jpg' },
            { id: 'CASO-2024-006', date: '2024-01-10', desc: 'Carcinoma de C√©lulas Renais - Mapeamento Vascular', statusText: 'Aguardando pagamento',  link3d: 'https://cirurgic3d.com.br/renal3dmodels/gbs/', thumb: '../assets/img/casos/Celulas-Renais.jpg' },
            { id: 'CASO-2024-008', date: '2024-01-08', desc: 'Volumetria Hep√°tica - Doador Vivo', statusText: 'Publicado',link3d: 'https://cirurgic3d.com.br/liver/cls/', thumb: '../assets/img/casos/Volumetria-Hepatica.jpg' },
            { id: 'CASO-2024-009', date: '2024-01-07', desc: 'Les√£o uterina - Avalia√ß√£o pr√©-operat√≥ria', statusText: 'Em an√°lise', link3d: 'https://cirurgic3d.com.br/uterus/acjsa/', thumb: '../assets/img/casos/Lesao-uterina.jpg' },
            { id: 'CASO-2024-010', date: '2024-01-06', desc: 'Avalia√ß√£o Pancre√°tica - Modelo 3D', statusText: 'Publicado', link3d: 'https://cirurgic3d.com.br/3dmodels/sno/', thumb: '../assets/img/casos/Pancreas.jpg'},
            { id: 'CASO-2024-011', date: '2024-01-05', desc: 'Planejamento de Pr√≥stata - Avalia√ß√£o Pr√©-operat√≥ria', statusText: 'Aguardando pagamento', link3d: 'https://cirurgic3d.com.br/prostate/dvf/', thumb: '../assets/img/casos/Prostata.jpg'}
        ];

        // Carrega dados espec√≠ficos do caso baseado na URL
        function carregarDadosDoCaso() {
            const id = new URLSearchParams(window.location.search).get('id');
            const caso = casesData.find(c => c.id === id);

            if (!caso) return;

            document.getElementById('breadcrumb-id').innerText = caso.id;
            document.getElementById('display-id').innerText = caso.id;
            document.getElementById('info-ref').innerText = caso.id;
            document.getElementById('info-model').innerText = caso.desc;
            document.getElementById('info-date').innerText = caso.date;
            document.getElementById('main-3d-image').src = caso.thumb;
            document.getElementById('link3d-btn').href = caso.link3d;
        }

        // L√≥gica de UI e Dropdown
        document.addEventListener('DOMContentLoaded', () => {
            carregarDadosDoCaso();

            const avatarToggle = document.getElementById('avatar-toggle');
            const userDropdown = document.getElementById('user-dropdown');

            if (avatarToggle && userDropdown) {
                avatarToggle.addEventListener('click', (e) => {
                    e.stopPropagation();
                    userDropdown.classList.toggle('show');
                });

                document.addEventListener('click', (e) => {
                    if (!userDropdown.contains(e.target) && e.target !== avatarToggle) {
                        userDropdown.classList.remove('show');
                    }
                });
            }

            const params = new URLSearchParams(window.location.search);
            const caseId = params.get('id');

            
            const renalScores = JSON.parse(localStorage.getItem('renalScores')) || {};
            const paduaScores = JSON.parse(localStorage.getItem('paduaScores')) || {};
            const piRadsScores = JSON.parse(localStorage.getItem('piRadsScores')) || {};
            const gleasonScores = JSON.parse(localStorage.getItem('gleasonScores')) || {};

            const container = document.getElementById('scoresContainer');
            let html = '';

            if (renalScores[caseId]) {
                const r = renalScores[caseId];
                html += `
                    <div style="margin-bottom:15px;">
                        <h4>RENAL Score</h4>
                        <p><strong>Escore:</strong> ${r.score}</p>
                        <p><strong>Classifica√ß√£o:</strong> ${r.classificacao}</p>
                        <p><strong>Data:</strong> ${r.dataAplicacao}</p>
                    </div>
                `;
            }

            if (paduaScores[caseId]) {
                const p = paduaScores[caseId];
                html += `
                    <div style="margin-bottom:15px;">
                        <h4>PADUA Score</h4>
                        <p><strong>Escore:</strong> ${p.score}</p>
                        <p><strong>Classifica√ß√£o:</strong> ${p.classificacao}</p>
                        <p><strong>Data:</strong> ${p.dataAplicacao}</p>
                    </div>
                `;
            }

            if (piRadsScores[caseId]) {
                const pr = piRadsScores[caseId];
                html += `
                    <div style="margin-bottom:15px;">
                        <h4>PI-RADS</h4>
                        <p><strong>Categoria:</strong> ${pr.score}</p>
                        <p><strong>Interpreta√ß√£o:</strong> ${pr.classificacao}</p>
                        <p><strong>Zona:</strong> ${pr.criterios.zona}</p>
                        <p><strong>Data:</strong> ${pr.dataAplicacao}</p>
                    </div>
                `;
            }

            if (gleasonScores[caseId]) {
                const g = gleasonScores[caseId];
                html += `
                    <div style="margin-bottom:15px;">
                        <h4>Gleason Score</h4>
                        <p><strong>Soma:</strong> ${g.score}</p>
                        <p><strong>Classifica√ß√£o:</strong> ${g.classificacao}</p>
                        <p><strong>Padr√£o Prim√°rio:</strong> ${g.criterios.primario}</p>
                        <p><strong>Padr√£o Secund√°rio:</strong> ${g.criterios.secundario}</p>
                        <p><strong>Data:</strong> ${g.dataAplicacao}</p>
                    </div>
                `;
            }

            container.innerHTML = html || `<p>Nenhum escore aplicado a este caso.</p>`;
        });
    </script>
</body>

</html>